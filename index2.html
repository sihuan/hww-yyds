<script src="https://code.highcharts.com/highcharts.js"></script>
<div id="container" style="height: 600px"></div>
<center>
    <button onclick="window.location.href='index.html'">
        点击查看得票总数
    </button>
</center>
<script>
    let chart; // global

    let votes = new Map()
    const name = new Map([
        [1, '丁庆军'],
        [2, '丁文江'],
        [3, '严大洲'],
        [4, '严新平'],
        [6, '何亮'],
        [7, '何建中'],
        [8, '何文波'],
        [9, '侯霞'],
        [11, '刘万学'],
        [12, '刘仲华'],
        [13, '刘友梅'],
        [15, '刘晶红'],
        [16, '刘洪涛'],
        [17, '刘立云'],
        [19, '刘英'],
        [20, '刘贤德'],
        [21, '励行根'],
        [22, '包云岗'],
        [23, '包亦望'],
        [24, '卓嘎'],
        [25, '南志标'],
        [26, '卜元卿'],
        [27, '卢金友'],
        [28, '史忠录'],
        [29, '叶姜'],
        [30, '叶志彪'],
        [31, '吕春祥'],
        [32, '吴剑'],
        [33, '吴时国'],
        [34, '吴险峰'],
        [35, '周少奇'],
        [36, '周建庭'],
        [37, '周昌栋'],
        [38, '周琦'],
        [39, '商鹏'],
        [40, '孔祥斌'],
        [41, '孙伟'],
        [42, '孙占祥'],
        [43, '孙宾成'],
        [44, '孙柏涛'],
        [46, '季节'],
        [47, '屠鹏飞'],
        [51, '常占东'],
        [52, '年夫顺'],
        [53, '廉玉波'],
        [54, '张其安'],
        [55, '张四春'],
        [58, '张汉谦'],
        [59, '张琨'],
        [60, '张飞'],
        [61, '彭木根'],
        [64, '戴好富'],
        [65, '易志坚'],
        [66, '景蕊莲'],
        [68, '朱恒银'],
        [69, '朱振才'],
        [70, '朱颜'],
        [72, '李军乔'],
        [73, '李家彪'],
        [74, '李家洋'],
        [76, '李建斌'],
        [77, '李德仁'],
        [78, '李志军'],
        [79, '李杰'],
        [80, '李清泉'],
        [82, '李灿'],
        [83, '李颖'],
        [84, '杜祖亮'],
        [85, '杨君兴'],
        [87, '杨贵庆'],
        [88, '梁海波'],
        [89, '梅锋'],
        [90, '殷国栋'],
        [92, '江亿'],
        [93, '江恩慧'],
        [94, '汤永禄'],
        [95, '汪在芹'],
        [96, '汪永寿'],
        [97, '洪德元'],
        [99, '熊康宁'],
        [100, '牟建新'],
        [102, '王冰'],
        [103, '王召明'],
        [105, '王天翔'],
        [106, '王家耀'],
        [107, '王小毛'],
        [108, '王强'],
        [109, '王成'],
        [110, '王文科'],
        [111, '王树声'],
        [112, '王浩'],
        [113, '王瀚晟'],
        [114, '王琦'],
        [115, '王贵玲'],
        [116, '田有亮'],
        [117, '番兴明'],
        [118, '石正丽'],
        [119, '秦晓威'],
        [120, '罗锡文'],
        [121, '聂凤英'],
        [122, '聂红'],
        [123, '胡叙洪'],
        [125, '范全林'],
        [126, '董战峰'],
        [127, '董雪'],
        [129, '蔡吉芳'],
        [130, '薛国强'],
        [131, '薛禹胜'],
        [132, '袁平荣'],
        [133, '谭久彬'],
        [134, '贾爱林'],
        [135, '赵东艳'],
        [136, '赵博'],
        [137, '赵炳然'],
        [139, '邢卫红'],
        [140, '邢建平'],
        [141, '邵国青'],
        [142, '郝林'],
        [143, '金卫平'],
        [144, '钱才让'],
        [146, '陈冠益'],
        [147, '陈卉丽'],
        [149, '陈子万'],
        [150, '陈学森'],
        [151, '陈宁生'],
        [152, '陈庆平'],
        [153, '陈红'],
        [154, '陈结'],
        [155, '陈邦林'],
        [156, '鞠正山'],
        [157, '韦本辉'],
        [158, '韩凤兰'],
        [159, '韩小平'],
        [160, '韩润生'],
        [161, '马克俭'],
        [162, '马利庄'],
        [163, '马洪琪'],
        [164, '高光磊'],
        [165, '鲁志宝'],
        [166, '黄伟九'],
        [167, '黄峰'],
        [168, '黄立'],
        [169, '龙伟民'],
        [170, '乔世雄'],
        [171, '余辉'],
        [172, '刁克剑'],
        [173, '刘中民'],
        [174, '刘家富'],
        [175, '吉万全'],
        [176, '吴群英'],
        [177, '孙万仓'],
        [178, '孙成忠'],
        [179, '孙红玲'],
        [180, '崔平'],
        [181, '崔洪芝'],
        [182, '常海涛'],
        [183, '张一敏'],
        [184, '张其圣'],
        [185, '张永新'],
        [186, '彭爱红'],
        [187, '扎西次仁'],
        [188, '曾志攀'],
        [189, '李永兵'],
        [190, '杨世滨'],
        [191, '海超'],
        [192, '潘国君'],
        [193, '熊海'],
        [194, '王文山'],
        [195, '禹代林'],
        [196, '程存刚'],
        [197, '罗建雄'],
        [198, '罗章'],
        [199, '胡彩萍'],
        [200, '蔡为明'],
        [201, '谢远泰'],
        [202, '贺桃源'],
        [203, '贾廷庆'],
        [204, '赵道全'],
        [205, '郑喜凤'],
        [206, '郑永良'],
        [207, '钟兴'],
        [208, '钟彩虹'],
        [209, '陈勇彪'],
        [210, '陈雯'],
        [211, '雷振生'],
        [212, '韩承伟'],
        [213, '马玉天'],
        [214, '马竞'],
        [215, '马雪英'],
        [216, '黄庆'],
        [217, '丁列明'],
        [218, '于波'],
        [219, '伊财富'],
        [220, '侯志勇'],
        [221, '刘昌孝'],
        [222, '包哈申'],
        [223, '包满珠'],
        [224, '匡铭'],
        [225, '向邦德'],
        [226, '吴尊友'],
        [227, '吴敏飞'],
        [228, '吴焕淦'],
        [229, '吴锦晖'],
        [230, '周春兰'],
        [231, '唐星'],
        [232, '央美'],
        [233, '姜艳芳'],
        [234, '孙材江'],
        [235, '官志忠'],
        [236, '廖燕庆'],
        [237, '张云'],
        [238, '张宏'],
        [239, '张抒扬'],
        [240, '张效房'],
        [241, '张玉莲'],
        [242, '张铭志'],
        [243, '张颖'],
        [244, '彭代辉'],
        [245, '徐静'],
        [246, '德格吉日呼'],
        [247, '戴立忠'],
        [248, '施剑林'],
        [249, '李小民'],
        [250, '李挥'],
        [251, '李旻辉'],
        [252, '李桂科'],
        [253, '李玲'],
        [254, '李琼珍'],
        [255, '杨巍'],
        [256, '杨柯'],
        [257, '杨玉'],
        [258, '柳红'],
        [259, '梁惠'],
        [260, '樊嘉'],
        [261, '武桂珍'],
        [262, '江磊'],
        [263, '汤静'],
        [264, '沈建忠'],
        [265, '渠桂荣'],
        [266, '燕铁斌'],
        [267, '王华东'],
        [268, '王季石'],
        [269, '王志刚'],
        [270, '王振海（宁夏）'],
        [271, '王振海（青海）'],
        [272, '王新华'],
        [273, '王智彪'],
        [274, '王海昌'],
        [275, '王红阳'],
        [276, '石汉平'],
        [277, '肖燕妮'],
        [278, '胡静菊'],
        [279, '舒畅'],
        [280, '苏学峰'],
        [281, '覃丽'],
        [282, '赵丽丽'],
        [283, '赵永才'],
        [284, '赵爽'],
        [285, '郎锦义'],
        [286, '郑建军'],
        [287, '郭利平'],
        [288, '阿尖措'],
        [289, '陈公平'],
        [290, '陈娟'],
        [291, '陈彦香'],
        [292, '陈彩蓉'],
        [293, '陈燕凌'],
        [294, '陈芳'],
        [295, '马信龙'],
        [296, '马玙'],
        [297, '高炳淼'],
        [298, '高秀梅'],
        [299, '鲜于云艳'],
        [300, '黎毅敏'],
        [301, '丁叁叁'],
        [302, '于海斌'],
        [303, '付巧妹'],
        [304, '冯小明'],
        [305, '冯景华'],
        [306, '刘玉超'],
        [307, '刘颖'],
        [308, '包幼林'],
        [309, '叶聪'],
        [310, '吴坚'],
        [311, '吴志强'],
        [312, '孙伟'],
        [313, '孙守旗'],
        [314, '孙泽洲'],
        [315, '孙珍'],
        [316, '孙绍山'],
        [317, '崔建勋'],
        [318, '庄文颖'],
        [319, '康世昌'],
        [320, '张建军'],
        [321, '支启军'],
        [322, '曹长群'],
        [323, '李亚军'],
        [324, '李剑秋'],
        [325, '李晋闽'],
        [326, '李晗'],
        [327, '李杰'],
        [328, '李永胜'],
        [329, '杨圆明'],
        [330, '杨帆'],
        [331, '杨德森'],
        [332, '杨戟'],
        [333, '杨树'],
        [334, '杨洪英'],
        [335, '杨秀荣'],
        [336, '杨霞'],
        [337, '段朝阳'],
        [338, '王坚'],
        [339, '王新蕊'],
        [340, '王来生'],
        [341, '王瑞'],
        [342, '王继平'],
        [343, '王艺臻'],
        [344, '田华雨'],
        [345, '秦大燕'],
        [346, '纪红兵'],
        [347, '聂磊'],
        [348, '胡可一'],
        [349, '胡方'],
        [350, '苏涛'],
        [351, '谭立英'],
        [352, '费本华'],
        [353, '赵新'],
        [354, '赵梓森'],
        [355, '赵淳生'],
        [356, '邹明'],
        [357, '陆明泉'],
        [358, '陈宗懋'],
        [359, '陈泉'],
        [360, '陈海生'],
        [361, '陈金勇'],
        [362, '马隆龙'],
        [363, '万素梅'],
        [364, '三百顿珠'],
        [365, '侯丙林'],
        [366, '侯旭'],
        [367, '冯秀花'],
        [368, '凌洪明'],
        [369, '刘娟'],
        [370, '刘德敏'],
        [371, '刘景圣'],
        [372, '刘欢'],
        [373, '刘进'],
        [374, '吕士成'],
        [375, '吴双清'],
        [376, '吴庆华'],
        [377, '吴晓民'],
        [378, '周进'],
        [379, '周金云'],
        [380, '喻佳俊'],
        [381, '宝乐德'],
        [382, '容新民'],
        [383, '屈磊'],
        [384, '张容鹄'],
        [385, '张应龙'],
        [386, '张彦龙'],
        [387, '张新长'],
        [388, '张琼'],
        [389, '张继'],
        [390, '张艳璇'],
        [391, '惠迎新'],
        [392, '曾玉彬'],
        [393, '朱定真'],
        [394, '朱述斌'],
        [395, '李丹莉'],
        [396, '李先琨'],
        [397, '李华'],
        [398, '李发洲'],
        [399, '李吉'],
        [400, '李志真'],
        [401, '李恒'],
        [402, '李淑兰'],
        [403, '杨多文'],
        [404, '林伟秋'],
        [405, '毕玉峰'],
        [406, '毕银丽'],
        [407, '沙国河'],
        [408, '沙有威'],
        [409, '王一航'],
        [410, '王亚男'],
        [411, '王兴国'],
        [412, '王发忠'],
        [413, '王婧'],
        [414, '王忠才'],
        [415, '王忠杰'],
        [416, '王成德'],
        [417, '王潭刚'],
        [418, '王茂森'],
        [419, '王西瑶'],
        [420, '王韬'],
        [421, '甘海燕'],
        [422, '田淑芬'],
        [423, '白静'],
        [424, '相宏宇'],
        [425, '程天赦'],
        [426, '罗青文'],
        [427, '胡冠芳'],
        [428, '胡国柱'],
        [429, '胡开辉'],
        [430, '胡永红'],
        [431, '莫华'],
        [432, '蔡兆翔'],
        [433, '许小华'],
        [434, '谭琦'],
        [435, '赵宝龙'],
        [436, '达瓦扎西'],
        [437, '郭晓蕙'],
        [438, '陈兵'],
        [439, '陈凡'],
        [440, '陈建强'],
        [441, '靳存旺'],
        [442, '韦持章'],
        [443, '韩布新'],
        [444, '黄超'],
        [445, '肖和平'],
        [446, '张建国'],
        [447, '吴少玉'],
        [448, '董家鸿'],
        [449, '杜青'],
        [450, '蒋敬庭'],
        [451, '胡伟武'],
        [453, '陈文光'],
        [454, '谭晓风'],
        [455, '王献礼'],
        [456, '黄文培'],
        [457, '武彦荣'],
        [458, '赵焕庭']
    ])
    const offest = new Date().getTimezoneOffset() * 60000;

    /**
    * Request data from the server, add it to the graph and set a timeout to request again
    */
    async function requestData() {
        const formData = new FormData();
        formData.append('uuid', '8d3a88ba9120401d9bcec085c30fd3f9');
        const result = await fetch('https://my-api.app.xinhuanet.com//vote/ext/list', {
            method: 'POST',
            body: formData,
            referrerPolicy: "no-referrer",
        }
        );
        if (result.ok) {
            const date = parseInt(new Date().getTime() / 1000) * 1000 - offest
            const data = await result.json();
            data.data.sort((a, b) => (a.voteNum < b.voteNum) ? 1 : -1)
            let yydss = data.data.slice(0, 10)

            yydss.forEach((v, i) => {
                const n = name.get(v.id)

                const preVotes = votes.get(v.id)
                votes.set(v.id,v.voteNum)

                if (preVotes === undefined) {
                    return
                }

                const point = [date, v.voteNum - preVotes];

                const series = chart.series.filter(s => {
                    return s.name === n
                })

                if (series[0] === undefined) {
                    chart.addSeries({
                        name: n,
                        data: [point],
                    })
                } else {
                    const shift = series[0].data.length > 20;
                    series[0].addPoint(point, true, shift);
                }
            });
            setTimeout(requestData, 1000);
        }
    }

    window.addEventListener('load', function () {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                defaultSeriesType: 'spline',
                events: {
                    load: requestData
                }
            },
            title: {
                text: '2021 最美科技工作者 得票增长数'
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150,
                maxZoom: 20 * 1000
            },
            yAxis: {
                minPadding: 0.2,
                maxPadding: 0.2,
                title: {
                    text: '得票增长数',
                    margin: 10
                }
            },
            series: []
        });
    });
</script>